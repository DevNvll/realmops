id: factorio
name: Factorio Headless Server
version: "1.0.0"
description: Factorio dedicated server with mod support

runtime:
  image: factoriotools/factorio:stable
  workdir: /factorio

storage:
  mountPath: /factorio

variables:
  - name: serverName
    label: Server Name
    description: Name shown in server browser
    type: string
    default: "Factorio Server"
    required: true
  - name: serverDescription
    label: Server Description
    description: Description shown in server browser
    type: string
    default: "A Factorio Server"
    required: false
  - name: maxPlayers
    label: Max Players
    description: Maximum number of players (0 = unlimited)
    type: number
    default: 0
    required: false
    min: 0
    max: 100
  - name: visibility
    label: Visibility
    description: Server visibility setting
    type: select
    default: public
    required: false
    options:
      - public
      - lan
      - hidden
  - name: requireUserVerification
    label: Require Verification
    description: Require Factorio account verification
    type: boolean
    default: true
    required: false
  - name: autosaveInterval
    label: Autosave Interval (minutes)
    description: Interval between autosaves
    type: number
    default: 5
    required: false
    min: 1
    max: 60

install:
  method: none

config:
  envVars:
    - name: SERVER_NAME
      value: "{{.serverName}}"
      template: true
    - name: SERVER_DESCRIPTION
      value: "{{.serverDescription}}"
      template: true
    - name: MAX_PLAYERS
      value: "{{.maxPlayers}}"
      template: true
    - name: VISIBILITY
      value: "{{.visibility}}"
      template: true
    - name: REQUIRE_USER_VERIFICATION
      value: "{{.requireUserVerification}}"
      template: true
    - name: AUTOSAVE_INTERVAL
      value: "{{.autosaveInterval}}"
      template: true

ports:
  - name: game
    containerPort: 34197
    protocol: udp
    hostPortMode: auto
    description: Factorio game port
  - name: rcon
    containerPort: 27015
    protocol: tcp
    hostPortMode: auto
    description: RCON admin port

start:
  command: []

health:
  type: udp
  port: 34197
  gracePeriod: 60
  interval: 30
  timeout: 10
  retries: 3

shutdown:
  signal: SIGTERM
  timeout: 30

mods:
  enabled: true
  targets:
    - name: mods
      path: /factorio/mods
      behavior: merge
  applyWhileRunning: false
